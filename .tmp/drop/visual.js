var organizationPasswordFilter1234567890ABCDEF;(()=>{"use strict";var t={639:(t,e,a)=>{function s(t,e){return{objectName:t,propertyName:e.name,selector:e.selector,altConstantValueSelector:e.altConstantSelector,instanceKind:e.instanceKind}}function i(t,e,a){return null==e||"object"==typeof e&&!e.solid?a:e.solid?{value:null==e?void 0:e.solid.color}:(null==t?void 0:t.items)?t.items.find(t=>t.value==e):e}a.d(e,{D:()=>i,y:()=>s})},667:(t,e,a)=>{a.d(e,{A:()=>s});const s=class{constructor(t){this.localizationManager=t}populateFormattingSettingsModel(t,e){var a,s,i;let n=new t,o=null===(s=null===(a=null==e?void 0:e[0])||void 0===a?void 0:a.metadata)||void 0===s?void 0:s.objects;return o&&(null===(i=n.cards)||void 0===i||i.forEach(t=>{var e,a,s;null===(e=null==t?void 0:t.slices)||void 0===e||e.forEach(e=>{null==e||e.setPropertiesValues(o,t.name)}),null===(s=null===(a=null==t?void 0:t.container)||void 0===a?void 0:a.containerItems)||void 0===s||s.forEach(e=>{var a;null===(a=null==e?void 0:e.slices)||void 0===a||a.forEach(e=>{null==e||e.setPropertiesValues(o,t.name)})})})),n}buildFormattingModel(t){var e;let a={cards:[]};return null===(e=t.cards)||void 0===e||e.forEach(t=>{if(!t)return;const e=t.name,s=t.name+"-group";let i={displayName:void 0,slices:[],uid:s},n=t.getFormattingCard(e,i,this.localizationManager);a.cards.push(n);const o={};if(t.container){const a=t.container,r=s+"-container",l={displayName:this.localizationManager&&a.displayNameKey?this.localizationManager.getDisplayName(a.displayNameKey):a.displayName,description:this.localizationManager&&a.descriptionKey?this.localizationManager.getDisplayName(a.descriptionKey):a.description,containerItems:[],uid:r};a.containerItems.forEach(t=>{const a=t.displayNameKey?t.displayNameKey:t.displayName,s=r+a;let i={displayName:this.localizationManager&&t.displayNameKey?this.localizationManager.getDisplayName(t.displayNameKey):t.displayName,slices:[],uid:s};this.buildFormattingSlices(t.slices,e,o,n,i.slices),l.containerItems.push(i)}),i.container=l}t.slices&&this.buildFormattingSlices(t.slices,e,o,n,i.slices),n.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(t)}),a}buildFormattingSlices(t,e,a,s,i){null==t||t.forEach(t=>{let n=null==t?void 0:t.getFormattingSlice(e,this.localizationManager);n&&(void 0===a[t.name]?a[t.name]=0:(a[t.name]++,n.uid=`${n.uid}-${a[t.name]}`),t.topLevelToggle?(n.suppressDisplayName=!0,s.topLevelToggle=n):i.push(n))})}getRevertToDefaultDescriptor(t){var e,a;const s={};let i=[],n=this.getSlicesRevertToDefaultDescriptor(t.name,t.slices,s),o=[];return null===(a=null===(e=t.container)||void 0===e?void 0:e.containerItems)||void 0===a||a.forEach(e=>{o=o.concat(this.getSlicesRevertToDefaultDescriptor(t.name,e.slices,s))}),i=n.concat(o),i}getSlicesRevertToDefaultDescriptor(t,e,a){let s=[];return null==e||e.forEach(e=>{e&&!a[e.name]&&(a[e.name]=!0,s=s.concat(e.getRevertToDefaultDescriptor(t)))}),s}}},674:(t,e,a)=>{a.d(e,{O:()=>i.A,z:()=>s});var s=a(754),i=a(667)},754:(t,e,a)=>{a.d(e,{Kx:()=>n,Zp:()=>o,jF:()=>l,ks:()=>c});var s=a(639);class i{}class n{}class o extends i{getFormattingCard(t,e,a){return{displayName:a&&this.displayNameKey?a.getDisplayName(this.displayNameKey):this.displayName,description:a&&this.descriptionKey?a.getDisplayName(this.descriptionKey):this.description,groups:[e],uid:t,analyticsPane:this.analyticsPane}}}class r extends i{constructor(t){super(),Object.assign(this,t)}getFormattingSlice(t,e){const a=this.type,s=this.name,i={displayName:e&&this.displayNameKey?e.getDisplayName(this.displayNameKey):this.displayName,description:e&&this.descriptionKey?e.getDisplayName(this.descriptionKey):this.description,uid:t+"-"+s};return Object.assign(Object.assign({},i),{control:{type:a,properties:this.getFormattingComponent(t,e)}})}getFormattingComponent(t,e){return{descriptor:s.y(t,this),value:this.value}}getRevertToDefaultDescriptor(t){return[{objectName:t,propertyName:this.name}]}setPropertiesValues(t,e){var a;let i=null===(a=null==t?void 0:t[e])||void 0===a?void 0:a[this.name];this.value=s.D(this,i,this.value)}}class l extends r{constructor(t){super(t),this.type="ToggleSwitch"}}class c extends r{constructor(t){super(t),this.type="TextInput"}getFormattingComponent(t){return Object.assign(Object.assign({},super.getFormattingComponent(t)),{placeholder:this.placeholder})}}},789:(t,e,a)=>{a.d(e,{v:()=>n});var s=a(674),i=a(980);class n{constructor(t){if(this.currentOrganization=null,this.allData=[],this.organizationColumn="Organization",this.organizationTableName="",this.organizationColumnQueryName="",!t)throw new Error("VisualConstructorOptions is required");this.host=t.host,this.element=t.element,this.formattingSettingsService=new s.O;const e=document.createElement("div");e.className="passwordFilterContainer";const a=document.createElement("div");a.className="passwordSection";const i=document.createElement("label");i.textContent="Enter Password:",i.className="passwordLabel",this.passwordInput=document.createElement("input"),this.passwordInput.type="password",this.passwordInput.className="passwordInput",this.passwordInput.placeholder="Enter password to filter by organization",this.submitButton=document.createElement("button"),this.submitButton.textContent="Filter",this.submitButton.className="submitButton",this.messageDiv=document.createElement("div"),this.messageDiv.className="messageDiv",a.appendChild(i),a.appendChild(this.passwordInput),a.appendChild(this.submitButton),a.appendChild(this.messageDiv);const n=document.createElement("div");n.className="tableSection",this.dataTable=document.createElement("table"),this.dataTable.className="dataTable",n.appendChild(this.dataTable),e.appendChild(a),e.appendChild(n),this.element.appendChild(e),this.submitButton.addEventListener("click",()=>this.handlePasswordSubmit()),this.passwordInput.addEventListener("keypress",t=>{"Enter"===t.key&&this.handlePasswordSubmit()})}update(t){this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(i.S,t.dataViews);const e=t.dataViews[0];if(!e||!e.table)return void this.showMessage("No data available","error");const a=e.table,s=a.rows;if(!s||0===s.length)return void this.showMessage("No data rows available","error");const n=a.columns.map(t=>t.displayName||t.queryName);this.allData=s.map(t=>{const e={};return n.forEach((a,s)=>{e[a]=t[s]}),e});const o=a.columns.findIndex(t=>{const e=(t.displayName||t.queryName||"").toLowerCase();return e.includes("organization")||e.includes("org")});if(o>=0){const t=a.columns[o];this.organizationColumn=t.displayName||t.queryName||"Organization";let s=t.queryName||"";if(e.metadata&&e.metadata.columns){const t=e.metadata.columns.find(t=>{const e=t.queryName||"",a=t.displayName||"";return e===s||a===this.organizationColumn||e.toLowerCase().includes("organization")||a.toLowerCase().includes("organization")});t&&t.queryName&&(s=t.queryName)}if(s&&s.includes(".")){const t=s.split(".");this.organizationTableName=t[0],this.organizationColumnQueryName=s}else{const t=a.columns.find(t=>t.queryName&&t.queryName.includes("."));if(t&&t.queryName){const e=t.queryName.split(".")[0];this.organizationTableName=e,this.organizationColumnQueryName=`${e}.${s||this.organizationColumn}`}else this.organizationTableName=s||this.organizationColumn,this.organizationColumnQueryName=s||this.organizationColumn}}this.currentOrganization?this.filterAndDisplayData(this.currentOrganization):this.displayData(this.allData,n)}handlePasswordSubmit(){var t,e,a;const s=this.passwordInput.value.trim();if(!s)return this.showMessage("Please enter a password","error"),this.currentOrganization=null,this.displayData(this.allData,Object.keys(this.allData[0]||{})),void this.clearFilter();const i=(null===(a=null===(e=null===(t=this.formattingSettings)||void 0===t?void 0:t.filterSettings)||void 0===e?void 0:e.organizationMapping)||void 0===a?void 0:a.value)||this.getDefaultPasswordMapping();let n;try{n="string"==typeof i?JSON.parse(i):i}catch(t){n=this.getDefaultPasswordMapping()}const o=n[s];if(!o)return this.showMessage("Invalid password","error"),this.currentOrganization=null,this.displayData(this.allData,Object.keys(this.allData[0]||{})),void this.clearFilter();this.currentOrganization=o,this.showMessage(`Filtered by: ${o}`,"success"),this.filterAndDisplayData(o),this.applyFilter(o)}getDefaultPasswordMapping(){return{FAO123:"FAO",UNICEF123:"UNICEF",UNHCR123:"UNHCR",WHO123:"WHO",WIPO123:"WIPO"}}filterAndDisplayData(t){const e=this.allData.filter(e=>String(e[this.organizationColumn]).toUpperCase()===t.toUpperCase()),a=Object.keys(this.allData[0]||{});this.displayData(e,a)}displayData(t,e){for(;this.dataTable.firstChild;)this.dataTable.removeChild(this.dataTable.firstChild);if(0===t.length){const t=this.dataTable.insertRow().insertCell();return t.colSpan=e.length,t.textContent="No data to display",void(t.className="noDataCell")}const a=this.dataTable.createTHead().insertRow();e.forEach(t=>{const e=document.createElement("th");e.textContent=t,a.appendChild(e)});const s=this.dataTable.createTBody();t.forEach(t=>{const a=s.insertRow();e.forEach(e=>{const s=a.insertCell(),i=t[e];s.textContent=null!=i?String(i):""})})}applyFilter(t){try{if(!this.organizationTableName||!this.organizationColumnQueryName)return void this.showMessage("Cannot apply filter - metadata not available","error");const e={$schema:"https://powerbi.com/product/schema#basic",target:{table:this.organizationTableName,column:this.organizationColumnQueryName},operator:"In",values:[t],filterType:1};this.host.applyJsonFilter(e,"general","filter",0)}catch(t){const e=(null==t?void 0:t.message)||String(t);this.showMessage(`Filter error: ${e}`,"error")}}clearFilter(){try{if(!this.organizationTableName||!this.organizationColumnQueryName)return;const t={$schema:"https://powerbi.com/product/schema#basic",target:{table:this.organizationTableName,column:this.organizationColumnQueryName},operator:"In",values:[],filterType:1};this.host.applyJsonFilter(t,"general","filter",0)}catch(t){}}showMessage(t,e){this.messageDiv.textContent=t,this.messageDiv.className=`messageDiv ${e}`,"success"===e&&setTimeout(()=>{this.messageDiv.textContent="",this.messageDiv.className="messageDiv"},3e3)}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettings)}enumerateObjectInstances(t){return[]}}},980:(t,e,a)=>{a.d(e,{S:()=>l});var s=a(674),i=s.z.Zp,n=s.z.Kx;class o extends i{constructor(){super(...arguments),this.password=new s.z.ks({name:"password",displayName:"Password",value:"",placeholder:""}),this.showPassword=new s.z.jF({name:"showPassword",displayName:"Show Password",value:!1}),this.name="passwordSettings",this.displayName="Password Settings",this.slices=[this.password,this.showPassword]}}class r extends i{constructor(){super(...arguments),this.organizationMapping=new s.z.ks({name:"organizationMapping",displayName:"Organization Password Mapping",value:JSON.stringify({FAO123:"FAO",UNICEF123:"UNICEF",UNHCR123:"UNHCR",WHO123:"WHO",WIPO123:"WIPO"},null,2),placeholder:'{"password1":"FAO","password2":"UNICEF"}'}),this.name="filterSettings",this.displayName="Filter Settings",this.slices=[this.organizationMapping]}}class l extends n{constructor(){super(...arguments),this.passwordSettings=new o,this.filterSettings=new r,this.cards=[this.passwordSettings,this.filterSettings]}}}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,a),n.exports}a.d=(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{a.r(s),a.d(s,{default:()=>n});var t=a(789),e=window.powerbi,i={name:"organizationPasswordFilter1234567890ABCDEF",displayName:"Organization Password Filter",class:"OrganizationPasswordFilter",apiVersion:"5.3.0",create:e=>{if(t.v)return new t.v(e);throw"Visual instance not found"},createModalDialog:(t,e,a)=>{const s=globalThis.dialogRegistry;t in s&&new s[t](e,a)},custom:!0};void 0!==e&&(e.visuals=e.visuals||{},e.visuals.plugins=e.visuals.plugins||{},e.visuals.plugins.organizationPasswordFilter1234567890ABCDEF=i);const n=i})(),organizationPasswordFilter1234567890ABCDEF=s})();